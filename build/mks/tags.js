define(["text!html/tags.html","bms-mapping","jquery.searchcontrol"],function(b,a,c){return Backbone.View.extend({events:{},saveTags:function(){var e=this;var d="";e.$el.find(".col2 .rightcol li").each(function(f){d+=$(this).find("a:nth-child(1) span").text()+","});return d.substring(0,d.length-1)},loadTags:function(){var e=this.app;var d=this;var f=this.campview;e.showLoading("Loading Tags...",d.$el.find(".leftcol"));URL="/pms/io/user/getData/?BMS_REQ_TK="+e.get("bms_token")+"&type=subscriberTagCountList";jQuery.getJSON(URL,function(k,h,i){e.showLoading(false,d.$el.find(".leftcol"));if(i&&i.responseText){var g=jQuery.parseJSON(i.responseText);var j="";if(g[0]!="err"){$.each(g.tagList[0],function(l,m){if(m[0].subCount==0){j+='<li class="action inactive" id="row_'+l+'" checksum="'+m[0].tag+'"><a class="tag"><span>'+m[0].tag+'</span><strong class="badge">'+m[0].subCount+"</strong></a></li>"}else{j+='<li class="action" id="row_'+l+'" checksum="'+m[0].tag+'"><a class="tag"><span>'+m[0].tag+'</span><strong class="badge">'+m[0].subCount+'</strong></a> <a class="btn-green move-row"><span>Use</span><i class="icon next"></i></a></li>'}});d.$el.find(".leftcol .tagslist ul").children().remove();d.$el.find(".leftcol .tagslist ul").html(j);f.$el.find("#area_choose_tags").removeData("mapping");f.$el.find("#area_choose_tags").mapping({sumColumn:"a.tag .badge",sumTarget:"tags_total_recps .badge",template:"",movingElement:"li"});if(f.states.step3.recipientType.toLowerCase()=="tags"){f.setRecipients()}}}});this.$el.find("div#tagssearch").searchcontrol({id:"tag-search",width:"210px",height:"25px",placeholder:"Search Tags",gridcontainer:"tagslist ul",showicon:"yes",movingElement:"li",iconsource:"tags"});this.$el.find("div#tagsrecpssearch").searchcontrol({id:"tag-recps-search",width:"210px",height:"25px",placeholder:"Search Recipients",gridcontainer:"tagsrecpslist ul",showicon:"yes",movingElement:"li",iconsource:"tags"});if(this.$el.find("#tagsrecpslist ul li").length==0){this.$el.find("#tag-recps-search").attr("disabled","disabled")}else{this.$el.find("#tag-recps-search").attr("disabled","")}},initialize:function(){this.template=_.template(b);this.render();this.app.showLoading(false,this.campview.$el.find("#area_choose_tags"));this.loadTags()},render:function(){this.app=this.options.app;this.campview=this.options.camp;this.$el.html(this.template({}))}})});