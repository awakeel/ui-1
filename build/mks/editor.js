define(["jquery","backbone","underscore","text!html/editor.html"],function(c,d,a,b){return d.View.extend({className:"fullwindow campaign-content",tagName:"div",events:{"click .btn-gray":function(e){this.hideEditor();this.page.wizard.back()},"click .mergefields-box":function(e){this.showMergeFieldDialog(e)},"click .save_editor":function(f){var e=c.getObj(f,"a");if(!e.hasClass("saving")){this.page.saveStep2(false);e.addClass("saving")}},"click #drop4":function(e){this.$el.find(".mergefields-box").click()},"click .save_continue_editor":function(){this.hideEditor();this.page.wizard.validateStep()},"click .selectiondropdown li":function(f){var e=this.options.opener;var g=c.getObj(f,"li");this.hideEditor();e.$el.find(".step2 #"+g.attr("id")).click()}},initialize:function(){this.template=a.template(b);this.page=this.options.opener;this.editor_id=this.options.wp_id;this.render()},render:function(){this.$el.html(this.template({}));this.$("#bmseditor").attr("id","bmseditor_"+this.editor_id)},showMergeFieldDialog:function(h){var e=c.getObj(h,"button");var m=e.offset();var g=e.width();var i=e.height();var j=m.top+i+11;var f=m.left-193;var l=c(".mergefields");c(".mergefields .browsefields #mergefields_links").show();if(l.css("display")=="block"&&parseInt(l.css("top"))==parseInt(j)){l.hide()}else{c(".mergefields .browsefields").show();l.addClass("mergefields_editor");c(".mergefields .searchfields,#remove-merge-list").hide();c("#merge_list_search").val("");l.css({top:j+"px",left:f+"px"}).show();var k="editor_mergeinput";l.attr("input-source",k);if(c(".merge-feilds-type li.active").length==0){c(".merge-feilds-type li#mergefields_basic").click()}}h.stopPropagation()},initEditor:function(e){var f=this;tinyMCE.init({mode:"exact",elements:"bmseditor_"+e.id,theme:"advanced",plugins:"contextmenu,fullscreen,inlinepopups,paste,searchreplace,iespell,style,table,visualchars,fullpage,preview,imagemanager",doctype:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">',element_format:"html",convert_urls:false,relative_urls:false,remove_script_host:false,paste_auto_cleanup_on_paste:true,paste_retain_style_properties:"none",paste_convert_middot_lists:false,paste_strip_class_attributes:"all",paste_remove_spans:true,paste_remove_styles:true,paste_text_use_dialog:true,paste_text_linebreaktype:"<br>",forced_root_block:"",force_br_newlines:true,force_p_newlines:false,convert_fonts_to_spans:false,valid_elements:"*[*]",height:450,theme_advanced_buttons1:"newdocument,bold,italic,underline,justifyleft,justifycenter,justifyright,justifyfull,formatselect,fontselect,fontsizeselect",theme_advanced_buttons2:"cut,copy,paste,pastetext,pasteword,search,replace,bullist,numlist,outdent,indent,blockquote,undo,redo,hr,removeformat,sub,sup,forecolor,backcolor,link,unlink,anchor,image,insertimage,cleanup,code,fullscreen,preview",theme_advanced_buttons3:"",plugin_preview_width:"950",plugin_preview_height:"750",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_statusbar_location:"bottom",theme_advanced_font_sizes:"8=8px,9=9px,10=10px,11=11px,12=12px,13=13px,14=14px,15=15px,16=16px,18=18px,20=20px,22=22px,24=24px,26=26px,28=28px,30=30px,36=36px",theme_advanced_fonts:"Arial=Arial;Comic Sans MS=Comic Sans MS;Courier=Courier;Courier New=Courier New;Georgia=Georgia;Tahoma=Tahoma;Times New Roman=Times New Roman;Trebuchet MS=Trebuchet MS;Lucinda Sans Unicode=Lucinda Sans Unicode;Verdana=Verdana",theme_advanced_resizing:true,content_css:"/pms/css/tiny_mce.css",template_external_list_url:"/pms/js/tiny_mce_templates.js",external_link_list_url:"lists/link_list.js",external_image_list_url:"lists/image_list.js",media_external_list_url:"lists/media_list.js",template_replace_values:{username:"Some User",staffid:"991234"},setup:function(g){g.onChange.add(function(i,h){f.page.states.editor_change=true})}})},showEditor:function(f){this.$el.show();c("body").css("overflow","hidden");c("html,body").scrollTop(0);var e=c(window).height()-166;this.$el.css({width:(c(window).width()-32)+"px",height:e+"px"});var g=e-172;this.$("#bmseditor_"+f+"_ifr").css("height",g+"px");c("#activities,#search,.icons-bar").hide();c(".camp_header #more-tool-actions li:nth-child(2)").hide();c(".camp_header #more-tool-actions li:nth-child(3)").hide();this.$("#editor_mergeinput").val("")},hideEditor:function(){this.$el.hide();c("body").css("overflow","auto");c(".camp_header").removeClass("workspace-fixed-editor");c("#activities,#search,.icons-bar").show();c(".camp_header #more-tool-actions li:nth-child(2)").show();c(".camp_header #more-tool-actions li:nth-child(3)").show()}})});